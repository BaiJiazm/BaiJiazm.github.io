---
title: 网络编程及知识
date: 2018/3/23 0:06:58 
tags:
- Network
- Review
---

## 网络编程

### select、poll和epoll编程
*   linux内核源码分析epoll的实现
*   [I/O并发编程总结](https://segmentfault.com/a/1190000004909797#articleHeader25)
*   [Linux IO模式及 select、poll、epoll详解](https://segmentfault.com/a/1190000003063859)

### select、poll和epoll问题
1. 阻塞读数据（不用epoll），你说读到一半有新消息又来了怎么办？
2. 非阻塞读数据（不用epoll），你说读到一半有新消息又来了怎么办？
3. epoll的ET模式时,如果数据只读了一半,也就是缓冲区的数据只读了一点,然后又来新事件了怎么办？
*   [epoll读到一半又有新事件来了怎么办？](https://blog.csdn.net/PROGRAM_anywhere/article/details/71408708)
*   [EPOLLONESHOT事件](http://www.voidcn.com/article/p-kxwjnibc-bmd.html)

### socket编程对应三次握手四次挥手

### Linux相关cpu内存网络相关指令

---
## 网络知识

### TCP三次握手与四次挥手
* [TCP\IP三次握手连接，四次握手断开分析](http://www.cnblogs.com/kesal/p/3285415.html)
* [TCP三次握手与四次挥手](http://www.cnblogs.com/tonyluis/p/5729531.html)
* [TCP连接的建立与终止](http://www.cnblogs.com/newwy/p/3234536.html)

### TCP三次握手，最后一次ACK包可以携带数据吗？有什么东西控制吗？什么时候携带数据？
*   RFC793文档里带有SYN标志的过程包是不可以携带数据的，也就是说三次握手的前两次是不可以携带数据的（逻辑上看，连接还没建立，携带数据好像也有点说不过去）。TCP协议建立连接的三次握手过程中的第三次握手允许携带数据。
*   [TCP连接建立的三次握手过程可以携带数据吗？](http://0xffffff.org/2015/04/15/36-The-TCP-three-way-handshake-with-data/)

### TCP四次挥手，为什么要有TIME_WAIT？如果有大量的TIME_WAIT怎么解决？
*   原因一：保证TCP协议的全双工连接能够可靠关闭
*   原因二：保证这次连接的重复数据段从网络中消失
*   第一点，如果Client直接CLOSED了，那么由于IP协议的不可靠性或者是其它网络原因，导致Server没有收到Client最后回复的ACK。那么Server就会在超时之后继续发送FIN，此时由于Client已经CLOSED了，就找不到与重发的FIN对应的连接，最后Server就会收到RST而不是ACK，Server就会以为是连接错误把问题报告给高层。这样的情况虽然不会造成数据丢失，但是却导致TCP协议不符合可靠连接的要求。所以，Client不是直接进入CLOSED，而是要保持TIME_WAIT，当再次收到FIN的时候，能够保证对方收到ACK，最后正确的关闭连接。
*   第二点，如果Client直接CLOSED，然后又再向Server发起一个新连接，我们不能保证这个新连接与刚关闭的连接的端口号是不同的。也就是说有可能新连接和老连接的端口号是相同的。一般来说不会发生什么问题，但是还是有特殊情况出现：假设新连接和已经关闭的老连接端口号是一样的，如果前一次连接的某些数据仍然滞留在网络中，这些延迟数据在建立新连接之后才到达Server，由于新连接和老连接的端口号是一样的，又因为TCP协议判断不同连接的依据是socket pair，于是，TCP协议就认为那个延迟的数据是属于新连接的，这样就和真正的新连接的数据包发生混淆了。所以TCP连接还要在TIME_WAIT状态等待2倍MSL，这样可以保证本次连接的所有数据都从网络中消失。
*   [更多了解](http://www.cnblogs.com/Jessy/p/3535612.html)

### TIME_WAIT过程中相关的Linux系统调用
*   [linux服务器大量TIME_WAIT状态问题](https://my.oschina.net/u/1024767/blog/757465)

### http状态码及报文格式
*   [HTTP 教程](http://www.runoob.com/http/http-status-codes.html)

### http和https的区别
*   [详细解析 HTTP 与 HTTPS 的区别](https://juejin.im/entry/58d7635e5c497d0057fae036)

### 微信扫一扫登录电脑界面的机制 
*   [微信扫码登录原理解析](http://blog.csdn.net/qq_25827845/article/details/78823861)

### 断点续传 
*   [Http 206 文件断点续传下载原理](https://my.oschina.net/ososchina/blog/371468)
*   [HTTP 断点续传（分块传输）](http://blog.csdn.net/liang19890820/article/details/53215087)

### TCP和UDP的区别
*   [网络面试题：TCP和UDP的9个区别是什么](https://blog.csdn.net/lzuacm/article/details/50945225)
*   [面试题：TCP协议与UDP协议的区别](https://blog.csdn.net/qq_18425655/article/details/51955674)

### TCP和UDP应用协议范围
![TCP和UDP应用协议范围](https://i.imgur.com/AUHCePc.png)

### 运行在TCP协议上的协议：
* HTTP（Hypertext Transfer Protocol，超文本传输协议），主要用于普通浏览。
* HTTPS（Hypertext Transfer Protocol over Secure Socket Layer, or HTTP over SSL，安全超文本传输协议）,HTTP协议的安全版本。
* FTP（File Transfer Protocol，文件传输协议），由名知义，用于文件传输。
* POP3（Post Office Protocol, version 3，邮局协议），收邮件用。
* SMTP（Simple Mail Transfer Protocol，简单邮件传输协议），用来发送电子邮件。
* TELNET（Teletype over the Network，网络电传），通过一个终端（terminal）登陆到网络。
* SSH（Secure Shell，用于替代安全性差的TELNET），用于加密安全登陆用。

### 运行在UDP协议上的协议：
* BOOTP（Boot Protocol，启动协议），应用于无盘设备。
* NTP（Network Time Protocol，网络时间协议），用于网络同步。
* DHCP（Dynamic Host Configuration Protocol，动态主机配置协议），动态配置IP地址。
* 其他：
* DNS（Domain Name Service，域名服务），用于完成地址查找，邮件转发等工作（运行在TCP和UDP协议上）。
* ECHO（Echo Protocol，回绕协议），用于查错及测量应答时间（运行在TCP和UDP协议上）。
* SNMP（Simple Network Management Protocol，简单网络管理协议），用于网络信息的收集和网络管理。
* ARP（Address Resolution Protocol，地址解析协议），用于动态解析以太网硬件的地址。

### TCP/IP协议栈中协议的层级：
|层次|层名|name|协议|
|:-|:-|:-|:-|
|7	|应用层   |application layer	|例如HTTP、SMTP、SNMP、FTP、Telnet、SIP、SSH、NFS、RTSP、XMPP、Whois、ENRP|
|6	|表示层   |presentation layer	|例如XDR、ASN.1、SMB、AFP、NCP|
|5	|会话层   |session layer	|例如ASAP、SSH、ISO 8327 / CCITT X.225、RPC、NetBIOS、ASP、IGMP、Winsock、BSD sockets|
|4	|传输层   |transport layer	|例如TCP、UDP、TLS、RTP、SCTP、SPX、ATP、IL|
|3	|网络层   |network layer	|例如IP、ICMP、IPX、BGP、OSPF、RIP、IGRP、EIGRP、ARP、RARP、X.25|
|2	|数据链路层 |data link layer	|例如以太网、令牌环、HDLC、帧中继、ISDN、ATM、IEEE 802.11、FDDI、PPP|
|1	|物理层   |physical layer	|例如线路、无线电、光纤|

### 流量控制原理
*   目的是接收方通过TCP头窗口字段告知发送方本方可接收的最大数据量，用以解决发送速率过快导致接收方不能接收的问题。所以流量控制是点对点控制。
*   TCP是双工协议，双方可以同时通信，所以发送方接收方各自维护一个发送窗和接收窗。
*   发送窗：用来限制发送方可以发送的数据大小，其中发送窗口的大小由接收端返回的TCP报文段中窗口字段来控制，接收方通过此字段告知发送方自己的缓冲（受系统、硬件等限制）大小。
*   接收窗：用来标记可以接收的数据大小。
*   TCP是流数据，发送出去的数据流可以被分为以下四部分：已发送且被确认部分 | 已发送未被确认部分 | 未发送但可发送部分 | 不可发送部分，其中发送窗 = 已发送未确认部分 + 未发但可发送部分。接收到的数据流可分为：已接收 | 未接收但准备接收 | 未接收不准备接收。接收窗 = 未接收但准备接收部分。
*   发送窗内数据只有当接收到接收端某段发送数据的ACK响应时才移动发送窗，左边缘紧贴刚被确认的数据。接收窗也只有接收到数据且最左侧连续时才移动接收窗口。

### 拥塞控制原理
*   拥塞控制目的是防止数据被过多注网络中导致网络资源（路由器、交换机等）过载。因为拥塞控制涉及网络链路全局，所以属于全局控制。控制拥塞使用拥塞窗口。
*   TCP拥塞控制算法：
*   慢开始 & 拥塞避免：先试探网络拥塞程度再逐渐增大拥塞窗口。每次收到确认后拥塞窗口翻倍，直到达到阀值ssthresh，这部分是慢开始过程。达到阀值后每次以一个MSS为单位增长拥塞窗口大小，当发生拥塞（超时未收到确认），将阀值减为原先一半，继续执行线性增加，这个过程为拥塞避免。
*   快速重传 & 快速恢复：略。
*   最终拥塞窗口会收敛于稳定值。

### 如何区分流量控制和拥塞控制
*   流量控制属于通信双方协商；拥塞控制涉及通信链路全局。
*   流量控制需要通信双方各维护一个发送窗、一个接收窗，对任意一方，接收窗大小由自身决定，发送窗大小由接收方响应的TCP报文段中窗口值确定；拥塞控制的拥塞窗口大小变化由试探性发送一定数据量数据探查网络状况后而自适应调整。
*   实际最终发送窗口 = min{流控发送窗口，拥塞窗口}。

### TCP如何提供可靠数据传输
*   建立连接（标志位）：通信前确认通信实体存在。
*   序号机制（序号、确认号）：确保了数据是按序、完整到达。
*   数据校验（校验和）：CRC校验全部数据。
*   超时重传（定时器）：保证因链路故障未能到达数据能够被多次重发。
*   窗口机制（窗口）：提供流量控制，避免过量发送。
*   拥塞控制：同上。